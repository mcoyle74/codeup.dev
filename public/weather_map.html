<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Weather Map</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

	<style type="text/css">
		body {
			background-color: #357;
		}
		h1,
		h2,
		label {
			color: #fff;
		}
		.col-sm-4 {
			text-align: center;
			background-color: #e0e0e0;
			border: 1px solid #888;
		}
		.row {
			margin: 5px;
			margin-bottom: 10px;
		}
		.form-control {
			display: inline;
			width: 25%;
		}
		#input-and-button {
			text-align: center;
		}
		.temperature {
			font-size: 1.2em;
			font-weight: bold;
		}
		#map-canvas {
			height: 400px;
			margin-top: 10px;
		}
	</style>
</head>
<body>
	<div class="container" id="weather-application">
		<h1>Weather Application</h1>
		<h2 id="place">San Antonio</h2>
		<div class="row" id="forecast-display"></div>
		<div id="input-and-button">
				<label for="placeInput">Place: </label>
				<input class="form-control" id="place-input" type="text" placeholder="Enter place name">
				<button class="btn btn-success" id="btn-update" type="button">Update</button>
		</div>
	</div>
	<div class="container" id="map-canvas"></div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCU1V2H7_6Fzw8z2GGimwi0herlv7pPsmY"></script>
	<script type="text/javascript">
		'use strict';
		var newPosition = {
			lat: 29.42,
			lng: -98.49
		}
		function weather () {
			$.get('http://api.openweathermap.org/data/2.5/forecast/daily', {
			APPID: '16d4c1bdb3097dd5a2e01eebdba6fe53',
			lat: newPosition.lat,
			lon: newPosition.lng,
			units: 'imperial',
			cnt: 3
		}).done(function(forecast) {
			var forecastInfo = '';
			console.log(forecast);
			var forecastDisplay = $('#forecast-display');
			if (forecast.list[0].weather[0].icon == '10d') {
				$('body').css({'background-image': 'url(/img/raindrops-window.jpeg)', 'background-size': 'cover', 'background-repeat': 'no-repeat'});
			} else if (forecast.list[0].weather[0].icon == '01d') {
				$('body').css({'background-image': 'url(/img/sunny-beach.jpeg)', 'background-size': 'cover', 'background-repeat': 'no-repeat'});
			} else if (forecast.list[0].weather[0].icon == ('02d' || '03d')) {
				$('body').css({'background-image': 'url(/img/clouds.jpeg)', 'background-size': 'cover', 'background-repeat': 'no-repeat'});
			} else {

			}
			forecast.list.forEach(function(day) {
				var forecastDay = new Date(day.dt * 1000);
				forecastInfo += '<div class="forecast col-sm-4">';
				forecastInfo += '<p>' + forecastDay.toString().substr(0, 10) + '</p>';
				forecastInfo += '<p class="temperature">' + 'High: ' + Math.round(day.temp.max) + '&deg; Low: ' + Math.round(day.temp.min) + '&deg;</p>';
				forecastInfo += '<img src="http://openweathermap.org/img/w/' + day.weather[0].icon + '.png">';
				forecastInfo += '<p>Clouds: ' + day.clouds + '%</p>';
				forecastInfo += '<p>Humidity: ' + day.humidity + '%</p>';
				forecastInfo += '<p>Wind: ' + day.speed + 'mph</p></div>';
			});
			forecastDisplay.html(forecastInfo);
			place.html(forecast.city.name);
		});
		};

		weather();

		var mapOptions = {
			zoom: 5,
			center: {
				lat: 29.42,
				lng: -98.49
			}
		};
		var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

		var marker = new google.maps.Marker({
				position: {
					lat: mapOptions.center.lat,
					lng: mapOptions.center.lng
				},
				map: 'map-canvas',
				draggable: true,
				title: 'Drag me!',
				animation: google.maps.Animation.DROP
		});
		marker.setMap(map);

		var updateButton = $('#btn-update');
		var place = $('#place');
		var placeInput = $('#place-input');

		updateButton.click(function() {
			var geocoder = new google.maps.Geocoder();

			geocoder.geocode({ "address": placeInput.val() }, function(results, status) {
				if (status == google.maps.GeocoderStatus.OK) {
					map.setCenter(results[0].geometry.location);
					newPosition = results[0].geometry.location;
					console.log(results[0]);
					place.html(results[0].address_components[0].long_name);
					weather();
				} else {
					alert("Geocoding was not successful - STATUS: " + status);
				}
			});		
		});

		placeInput.keydown(function(event) {
			if (event.keyCode == 13) {
				updateButton.click();
			}
		})

		marker.addListener('dragend', function(event) {
			newPosition = event.latLng;
			weather();
		})

	</script>
</body>
</html>